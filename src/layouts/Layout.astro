---
import "@fontsource/fira-code";
import "@fontsource/protest-revolution";
import Navbar from "../components/navbar/Navbar.astro";
import BaseHead from "@/components/UI/BaseHead.astro";
interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
const { currentLocale } = Astro;
---

<!doctype html>
<html lang={currentLocale}>
  <head>
    <BaseHead title={title} description={description} />
  </head>
  <body class="relative text-slate-900 dark:text-slate-200">
    <div class="fixed inset-0 z-[-2] bg-slate-50 dark:bg-[#0a0f1e]">
      <div
        class="absolute inset-0 bg-[radial-gradient(ellipse_80%_50%_at_50%_-20%,rgba(94,234,212,0.12),transparent)] dark:bg-[radial-gradient(ellipse_80%_50%_at_50%_-20%,rgba(94,234,212,0.08),transparent)]"
      >
      </div>
      <div class="mesh-gradient"></div>
    </div>

    <Navbar />
    <main class="main">
      <slot />
    </main>
    <div class="invisible sm:visible" id="cursor"></div>

    <script>
      const theme = (() => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      })();

      if (theme === "light") {
        document.documentElement.classList.remove("dark");
      } else {
        document.documentElement.classList.add("dark");
      }

      // Cursor glow
      const cursorEl: HTMLElement = document.querySelector("#cursor")!;
      const target = { x: 0.5, y: 0.5 };
      const cursor = { x: 0.5, y: 0.5 };
      let raf: number | undefined;

      const lerp = (a: number, b: number, speed: number) =>
        (1 - speed) * a + speed * b;

      const update = () => {
        cursor.x = lerp(cursor.x, target.x, 0.1);
        cursor.y = lerp(cursor.y, target.y, 0.1);
        cursorEl?.style.setProperty("--x", `${cursor.x}`);
        cursorEl?.style.setProperty("--y", `${cursor.y}`);

        const delta = Math.sqrt(
          Math.pow(target.x - cursor.x, 2) + Math.pow(target.y - cursor.y, 2)
        );

        if (delta < 0.001) {
          raf && cancelAnimationFrame(raf);
          raf = undefined;
          return;
        }
        raf = requestAnimationFrame(update);
      };

      const handleMouseMove = (event: any) => {
        target.x = event.clientX / window.innerWidth;
        target.y = event.clientY / window.innerHeight;
        if (!raf) raf = requestAnimationFrame(update);
      };

      window.addEventListener("mousemove", handleMouseMove);
      raf = requestAnimationFrame(update);
    </script>

    <style is:global>
      :root {
        color-scheme: light dark;
      }

      html {
        font-family: "Fira Code", monospace;
        scroll-behavior: smooth;
      }

      .mesh-gradient {
        position: absolute;
        inset: 0;
        opacity: 0;
        background: linear-gradient(
          135deg,
          rgba(94, 234, 212, 0.04) 0%,
          transparent 40%,
          rgba(56, 189, 248, 0.03) 60%,
          transparent 100%
        );
        background-size: 200% 200%;
        animation: meshMove 20s ease infinite;
      }

      .dark .mesh-gradient {
        opacity: 1;
      }

      @keyframes meshMove {
        0%,
        100% {
          background-position: 0% 0%;
        }
        25% {
          background-position: 100% 0%;
        }
        50% {
          background-position: 100% 100%;
        }
        75% {
          background-position: 0% 100%;
        }
      }

      #cursor {
        --size: 500px;
        --x: 0;
        --y: 0;
        position: fixed;
        top: 0;
        left: 0;
        width: var(--size);
        height: var(--size);
        border-radius: 100%;
        transform: translate3d(
          calc(100vw * var(--x) - (var(--size) / 2)),
          calc(100vh * var(--y) - var(--size) / 2),
          0
        );
        background: radial-gradient(
          circle,
          rgba(94, 234, 212, 0.06),
          transparent 70%
        );
        pointer-events: none;
        z-index: 1;
      }

      .dark #cursor {
        background: radial-gradient(
          circle,
          rgba(94, 234, 212, 0.08),
          transparent 70%
        );
      }
    </style>
  </body>
</html>
