---
import SunIcon from "@/components/icons/SunIcon.astro";
import MoonIcon from "@/components/icons/MoonIcon.astro";
---

<div
  class="inline-flex items-center p-[2px] rounded-full bg-slate-200 dark:bg-slate-800 transition-colors"
>
  <button
    id="theme-toggle-sun"
    class="cursor-pointer rounded-full p-1.5 transition-all duration-200"
    aria-label="Toggle light theme"
  >
    <SunIcon class="h-5 w-5" />
  </button>
  <button
    id="theme-toggle-moon"
    class="cursor-pointer rounded-full p-1.5 transition-all duration-200"
    aria-label="Toggle dark theme"
  >
    <MoonIcon class="h-5 w-5" />
  </button>
</div>

<script is:inline>
  const matchMedia = window.matchMedia("(prefers-color-scheme: dark)");

  const getThemePreference = () => {
    if (typeof localStorage !== "undefined") {
      return localStorage.getItem("theme") ?? "system";
    }
    return window.matchMedia("(prefers-color-scheme: dark)").matches
      ? "dark"
      : "light";
  };

  const btnSun = document.getElementById("theme-toggle-sun");
  const btnMoon = document.getElementById("theme-toggle-moon");

  function handleButtonClick(clickedButton, otherButton) {
    clickedButton.classList.add("bg-white", "dark:bg-slate-700", "text-amber-500", "dark:text-accent", "shadow-sm");
    otherButton.classList.remove("bg-white", "dark:bg-slate-700", "text-amber-500", "dark:text-accent", "shadow-sm");
  }

  btnSun.addEventListener("click", function () {
    handleButtonClick(btnSun, btnMoon);
    localStorage.setItem("theme", "light");
    updateTheme();
  });

  btnMoon.addEventListener("click", function () {
    handleButtonClick(btnMoon, btnSun);
    localStorage.setItem("theme", "dark");
    updateTheme();
  });

  const updateTheme = () => {
    const themePreference = getThemePreference();
    const isDark =
      themePreference === "dark" ||
      (themePreference === "system" && matchMedia.matches);

    btnSun.classList[!isDark ? "add" : "remove"]("bg-white", "dark:bg-slate-700", "text-amber-500", "dark:text-accent", "shadow-sm");
    btnMoon.classList[isDark ? "add" : "remove"]("bg-white", "dark:bg-slate-700", "text-amber-500", "dark:text-accent", "shadow-sm");

    document.documentElement.classList[isDark ? "add" : "remove"]("dark");
  };

  updateTheme();
</script>
