---
import Language from "@/components/icons/LanguageIcon.astro";
import { languages } from "@/i18n/ui";
import { getLangFromUrl, useTranslatedPath } from "@/i18n/utils.ts";

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);
---

<div class="relative inline-block text-left">
  <button
    class="language-button rounded-full border border-slate-300 dark:border-slate-700 p-1.5 text-slate-600 dark:text-slate-400 hover:border-accent dark:hover:border-accent hover:text-accent-dark dark:hover:text-accent transition-all duration-200"
    aria-label="Change language"
  >
    <Language class="h-5 w-5" />
  </button>
  <ul
    class="hidden absolute right-0 z-10 mt-2 min-w-[120px] origin-top-right rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-lg hidden-language-menu overflow-hidden"
  >
    {
      Object.entries(languages).map(([langPrefix, langName]) => {
        return (
          <li>
            <a
              class="block px-4 py-2.5 text-sm text-slate-700 dark:text-slate-300 hover:bg-accent-muted hover:text-accent-dark dark:hover:text-accent transition-colors"
              href={translatePath("/", langPrefix)}
            >
              {langName}
            </a>
          </li>
        );
      })
    }
  </ul>
</div>

<script is:inline>
  const languageButton = document.querySelector(".language-button");
  const languageOpenFromLang = document.querySelector(".hidden-language-menu");
  const burgerOpenFromlang = document.querySelector(".hidden-menu");

  languageButton?.addEventListener("click", () => {
    languageOpenFromLang?.classList.toggle("hidden");
    burgerOpenFromlang?.classList.add("hidden");
  });
</script>
